## Semantic Annotation of String

思考：

针对「格式化文本内容」进行快速人工标注，用于可视化，
- 如何迅速的将一段格式化文字，变为数据，并且不破坏它的型态？

设计一种String内不破坏文本展示的格式来进行标记。（知识产权注意）

类似HTML

转换文本描述内容为类似KV对的数据结构 （顺序处理）

使用不常见但较为容易输入的字符作为annotation

"患者肺部体积为：1552.3ml，其中病灶占肺部的比例为：26.6%，所有病灶平均Hu为：-469，肺部区域共发现10处异常区域，病情评估为：较为严重。"
"患者`肺部体积`为：`1552.3``ml`，其中`病灶占肺部的比例`为：`26.6``%`，所有`病灶平均Hu`为：`-469`，肺部区域共发现`10``处``异常区域`，`病情评估`为：`较为严重`。"

可见 “异常区域”为 倒装内容，需要特殊处理（加入KEY VALUE区分）

"患者`@肺部体积@`为：`1552.3``ml`，其中`@病灶占肺部的比例@`为：`26.6``%`，所有`@病灶平均Hu@`为：`-469`，肺部区域共发现`10``处``@异常区域@`，`@病情评估@`为：`较为严重`。"

在流处理的过程中，倒装内容的KV关系难以确定 所以需要进一步加入「Key Defer」指令 - 即，key在后方！

"患者`@肺部体积`为：`1552.3``ml`，其中`@病灶占肺部的比例`为：`26.6``%`，所有`@病灶平均Hu`为：`-469`，`@`肺部区域共发现`10``处``@异常区域`，`@病情评估`为：`较为严重`。"

预计得到的输出：
``` javascript
{
    "肺部体积": [ 1552.3, 'ml' ],
    "病灶占肺部的比例": [ 26.6, '%' ],
    "病灶平均Hu": -469,
    "异常区域": [ 10, '处' ],
    "病情评估": "较为严重"
}
```

可见部分内容将被自动Normalize为KV对，这个行为应该是可控的，并且改变了@的行为设计，@目前的定义是“向Key中增加文本”，提升了自由度。

"患者`&肺部体积`为：`1552.3``ml`，其中`&病灶占肺部的比例`为：`26.6``%`，所有`&[2]病灶平均Hu`为：`-469`，`&`肺部区域共发现`10``处``@异常区域`，`&[]病情评估`为：`较为严重`。"


预计得到的输出(2)：
``` javascript
{
    "肺部体积": [ 1552.3, 'ml' ],
    "病灶占肺部的比例": [ 26.6, '%' ],
    "病灶平均Hu": [-469, null],
    "异常区域": [ 10, '处' ],
    "病情评估": ["较为严重"]
}
```

为了可读性的可变格式，只要满足上方的核心设计，符号可被替换，其中^替换了旧的“终止”符号。进一步精简了设计。

患者<肺部体积>为：[1552.3][ml]，其中<病灶占肺部的比例>为：[26.6][%]，所有<病灶平均Hu[2]>为：[-469]，肺部区域共发现[^10][处]<异常区域>，<病情评估[2]>为：[较为严重]。

可读性尝试2，Defer符号变化，并且展示了Key拼接能力。
患者<肺部体积>为：[1552.3][ml]，其中<病灶占肺部>的<+比例>为：[26.6][%]，所有<病灶平均Hu[2]>为：[-469]，<?>肺部区域共发现[10][处]<+异常区域>，<病情评估[2]>为：[较为严重]。


预计得到的输出(3) 包含了互动所需的必要META信息：
``` javascript
{
    "pure": {
        "肺部体积": [ 1552.3, 'ml' ],
        "病灶占肺部的比例": [ 26.6, '%' ],
        "病灶平均Hu": [-469, null],
        "异常区域": [ 10, '处' ],
        "病情评估": ["较为严重"]
    },
    "meta": {
        "肺部体积": {"start": -1, "end": -1, "chunk": "...", "length": ".." }
    },
    "all": {
        ...
    }
}
```

算法(pcode)：
```javascript
function denote(str) {
    var ops = {
        sk: "<", //start key
        ak: "+", //append key
        ek: ">", //end key
        dk: "?", //defer key
        skm: "[", //start key meta
        ekm: "]", //end key meta
        sv: "[", //defer key
        ev: "]", //defer key
    };
    var result = {};
    var context = 0; //0 = none, 1 = key, 2 = value
    var key_frag = "";
    var val_frag = "";
    var key = "";
    var val = [];
    var start = 0;
    var len = 0;
    var end = 0;
    for(var i = 0; i < str.length; i++) {
        if(context == 0) {
            
        }
    }
}
```

